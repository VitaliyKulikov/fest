<?xml version="1.0"?>
<project name="fest-swing" default="all" basedir="." xmlns:artifact="urn:maven-artifact-ant">

	<import file="../build-template.xml"/>

	<target name="install-abbot">
		<property name="abbot.maven.dir" value="${basedir}/abbot-maven"/>

		<path id="maven.classpath">
			<pathelement location="../maven/maven-ant-tasks-2.0.6.jar" />
		</path>

		<typedef resource="org/apache/maven/artifact/ant/antlib.xml" uri="urn:maven-artifact-ant">
			<classpath refid="maven.classpath" />
		</typedef>

		<artifact:pom file="${abbot.maven.dir}/pom.xml" id="maven.abbot.project" />
		<artifact:install file="${abbot.maven.dir}/abbot-1.0.0.rc5.jar">
			<pom refid="maven.abbot.project" />
			<artifact:localRepository id="local.repository" location="${maven.repository.local}" layout="default" />
		</artifact:install>
	</target>

	<target name="junit-test" depends="compile">
		<property name="target.junit.results.dir" value="${target.dir}/junit-results" />
		<property name="target.junit.report.dir" value="${target.dir}/junit-report" />
		<property name="fest.screenshot.dir" value="${target.junit.results.dir}/screenshots" />
		<mkdir dir="${target.junit.results.dir}"/>
		<mkdir dir="${target.junit.report.dir}"/>
		<junit forkmode="perBatch" printsummary="yes" haltonfailure="no" haltonerror="no">
			<classpath refid="lib.classpath" />
			<classpath location="${target.test.classes.dir}" />
			<classpath location="${target.classes.dir}" />
			<formatter classname="org.fest.swing.junit.ScreenshotOnFailureResultFormatter" extension=".xml" />
			<batchtest fork="yes" todir="${target.junit.results.dir}">
				<fileset dir="${target.classes.dir}" includes="**/*DummyTest*.class" />
			</batchtest>
		</junit>
		<junitreport todir="${target.junit.report.dir}">
			<fileset dir="${target.junit.results.dir}">
				<include name="TEST-*.xml" />
			</fileset>
			<report format="frames"
			        styledir="${src.java.main.dir}/org/fest/swing/junit"
			        todir="${target.junit.report.dir}/html" />
		</junitreport>
	</target>

</project>
