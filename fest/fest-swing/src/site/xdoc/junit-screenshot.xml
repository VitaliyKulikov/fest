<?xml version="1.0" encoding="UTF-8"?>
<document>

  <properties>
    <title>Taking Screenshots of JUnit Failed Tests</title>
  </properties>

  <body>
    <section name="Taking Screenshots of JUnit Failed Tests">
      <p>
        FEST-Swing can take a screenshot of the desktop when a <a href="http://www.junit.org" target="_blank">JUnit</a> 
        GUI test fails, either when running tests using Ant or inside an IDE (e.g. 
        <a href="http://www.eclipse.org" target="_blank">Eclipse</a>.)
      </p>
      <p>
        To take screenshots of failed GUI tests, regardless of how they are executed, please follow these steps:
        <ol>
          <li>
            Add the FEST JUnit Extension to your classpath (file fest-swing-junit-{VERSION}.jar, included when you
            download FEST-Swing)
          </li>
          <li>
            Mark GUI tests (class or method level) with the annotation <code class="code">org.fest.swing.annotation.GUITest</code>
          </li>
        </ol>
      </p>
      <p>
        FEST-Swing JUnit extension requires JUnit 4.3.1.
      </p>
      <subsection name="Running GUI tests with Ant">
        <p>
          In order to take screenshots of failed GUI tests with <a href="http://ant.apache.org" target="_blank">Ant</a>
          please follow these steps:
          <ol>
            <li>Add a definition of the Ant task <code class="code">festreport</code></li>
            <li>Use the formatter <code class="code">org.fest.swing.junit.ant.ScreenshotOnFailureResultFormatter</code> 
            inside the junit Ant task</li>
            <li>Use the Ant task <code class="code">festreport</code> instead of <code class="code">junitreport</code>, 
            and specify in its classpath where the fest-swing-junit-{VERSION}.jar file is.</li>            
          </ol>
        </p>
        <p>
          Example (please note the text in orange/red):
          <pre class="prettyprint">
  &lt;<span class="tag">target</span>&#160;<span class="atn">name</span>=<span class="atv">&quot;test&quot;</span>&#160;<span class="atn">depends</span>=<span class="atv">&quot;compile&quot;</span>&gt;
    &lt;<span class="htag">taskdef</span>&#160;<span class="hatn">resource</span>=<span class="hatv">&quot;festjunittasks&quot;</span>&#160;<span class="hatn">classpathref</span>=<span class="hatv">&quot;lib.classpath&quot;</span> /&gt;
    
    &lt;<span class="tag">junit</span>&#160;<span class="atn">forkmode</span>=<span class="atv">&quot;perBatch&quot;</span>&#160;<span class="atn">printsummary</span>=<span class="atv">&quot;yes&quot;</span>&#160;<span class="atn">haltonfailure</span>=<span class="atv">&quot;no&quot;</span>&#160;<span class="atn">haltonerror</span>=<span class="atv">&quot;no&quot;</span>&gt;
      &lt;<span class="tag">classpath</span>&#160;<span class="atn">refid</span>=<span class="atv">&quot;lib.classpath&quot;</span> /&gt;
      &lt;<span class="tag">classpath</span>&#160;<span class="atn">location</span>=<span class="atv">&quot;${target.test.classes.dir}&quot;</span> /&gt;
      &lt;<span class="tag">classpath</span>&#160;<span class="atn">location</span>=<span class="atv">&quot;${target.classes.dir}&quot;</span> /&gt;
      &lt;<span class="htag">formatter</span>&#160;<span class="hatn">classname</span>=<span class="hatv">&quot;org.fest.swing.junit.ant.ScreenshotOnFailureResultFormatter&quot;</span>&#160;<span class="hatn">extension</span>=<span class="hatv">&quot;.xml&quot;</span> /&gt;
      &lt;<span class="tag">batchtest</span>&#160;<span class="atn">fork</span>=<span class="atv">&quot;yes&quot;</span>&#160;<span class="atn">todir</span>=<span class="atv">&quot;${target.junit.results.dir}&quot;</span>&gt;
        &lt;<span class="tag">fileset</span>&#160;<span class="atn">dir</span>=<span class="atv">&quot;${target.test.classes.dir}&quot;</span>&#160;<span class="atn">includes</span>=<span class="atv">&quot;**/*Test*.class&quot;</span> /&gt;
      &lt;/<span class="tag">batchtest</span>&gt;
    &lt;/<span class="tag">junit</span>&gt;
    
    &lt;<span class="htag">festreport</span>&#160;<span class="hatn">todir</span>=<span class="hatv">&quot;${target.junit.report.dir}&quot;</span>&gt;
      &lt;<span class="htag">classpath</span>&#160;<span class="hatn">refid</span>=<span class="hatv">&quot;lib.classpath&quot;</span> /&gt;
      &lt;<span class="tag">fileset</span>&#160;<span class="atn">dir</span>=<span class="atv">&quot;${target.junit.results.dir}&quot;</span>&gt;
        &lt;<span class="tag">include</span>&#160;<span class="atn">name</span>=<span class="atv">&quot;TEST-*.xml&quot;</span> /&gt;
      &lt;/<span class="tag">fileset</span>&gt;
      &lt;<span class="tag">report</span>&#160;<span class="atn">format</span>=<span class="atv">&quot;frames&quot;</span>&#160;<span class="atn">todir</span>=<span class="atv">&quot;${target.junit.report.dir}/html&quot;</span> /&gt;
    &lt;/<span class="tag">festreport</span>&gt;
  &lt;/<span class="tag">target</span>&gt;</pre>          
        </p>
        <p>
          The following is a screenshot of a JUnit HTML report:
        </p>        
        <p>
          <center>
            <img src="../images/junit-ext.jpg" border="0" />
          </center>
        </p>
        <p>
          The Ant task <code class="code">festreport</code> works exactly as <code class="code">junitreport</code>, it 
          can generate HTML reports with or without frames.
        </p>
        <p>
          The Ant task has been tested with Ant 1.7 and requires 
          <a href="http://commons.apache.org/codec/" target="_blank">Apache-Commons Codec 1.3</a>.
        </p>
      </subsection>
      <subsection name="Running GUI tests in an IDE">
        <p>
          FEST-Swing also provides a custom JUnit Runner, <code class="code">org.fest.swing.junit.GUITestRunner</code>,
          which takes screenshots of failed GUI tests. To use it, just annotate your test class with 
          &quot;<code class="code">@RunWith(GUITestRunner.class)</code>.&quot; Screenshots of failed tests will be saved
          in the directory &quot;failed-gui-tests&quot; (relative to the directory where tests are executed.)
        </p>
        <p>
          <code class="code">GUITestRunner</code> has been tested with Eclipse 3.1.1. It is currently not working with
          IntelliJ IDEA due to bug <a href="http://www.jetbrains.net/jira/browse/IDEA-13389" target="_blank">IDEA-13389</a>.
        </p>
      </subsection>
    </section>
  </body>
</document>  
