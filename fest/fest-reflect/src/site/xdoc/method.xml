<?xml version="1.0" encoding="UTF-8"?>
<document>

  <properties>
    <title>Invoking Methods</title>
  </properties>

  <body>
    <section name="Invoking Methods">
      <p>
        We will use an example to better understand FEST-Reflect's 
        <a href="http://martinfowler.com/bliki/FluentInterface.html" target="_blank">fluent interface</a> for 
        method invocation.
      </p>
      <p>  
        Let's assume we have a simple class <code class="code">Names</code> that defines the following methods:
        <pre class="prettyprint">
<span class="kwd">class</span>&#160;<span class="typ">Names</span> {

  <span class="kwd">private final</span>&#160;<span class="typ">List</span>&lt;String&gt; names = <span class="kwd">new</span>&#160;<span class="fnc">ArrayList</span>&lt;String&gt;();

  <span class="kwd">void</span>&#160;<span class="fnc">clear</span>() {
    names.<span class="fnc">clear</span>();
  }

  <span class="kwd">int</span>&#160;<span class="fnc">size</span>() {
    <span class="kwd">return</span> names.<span class="fnc">size</span>();
  }

  <span class="kwd">void</span>&#160;<span class="fnc">add</span>(<span class="typ">String</span> name) {
    names.<span class="fnc">add</span>(name);  
  }

  <span class="typ">String</span>&#160;<span class="fnc">get</span>(<span class="kwd">int</span> index) {
    <span class="kwd">return</span> names.<span class="fnc">get</span>(index);
  }  

}</pre>
      </p>
      <p>
        The following sections compares method invocation using Java Reflection and FEST-Reflect. We will assume that
        we have the variable 'names' of type <code class="code">Names</code>. We are also going to assume the following
        static import:
        <pre class="prettyprint">
<span class="kwd">import static</span> org.fest.reflect.core.Reflection.method;</pre>
      </p>
      
      <subsection name="Invoking methods without parameters and return type 'void'">
        <p>
          Java Reflection:
          <pre class="prettyprint">
<span class="typ">Method</span> method = Names.<span class="kwd">class</span>.<span class="fnc">getMethod</span>(<span class="str">&quot;clear&quot;</span>);

AccessController.<span class="fnc">doPrivileged</span>(<span class="kwd">new</span>&#160;<span class="fnc">PrivilegedAction</span>&lt;Void&gt;() {
  <span class="kwd">public</span> Void <span class="fnc">run</span>() {
    method.<span class="fnc">setAccessible</span>(<span class="kwd">true</span>);
    <span class="kwd">return null</span>;
  }
});    

method.<span class="fnc">invoke</span>(names);</pre>
        </p>
        <p>
          FEST-Reflect:
          <pre class="prettyprint">
<span class="fnc">method</span>(<span class="str">&quot;clear&quot;</span>).<span class="fnc">in</span>(names).<span class="fnc">invoke</span>();</pre>
        </p>
      </subsection>
      
      <subsection name="Invoking methods with parameters and return type 'void'">
        <p>
          Java Reflection:
          <pre class="prettyprint">
<span class="typ">Method</span> method = Names.<span class="kwd">class</span>.<span class="fnc">getMethod</span>(<span class="str">&quot;add&quot;</span>, String.<span class="kwd">class</span>);

AccessController.<span class="fnc">doPrivileged</span>(<span class="kwd">new</span>&#160;<span class="fnc">PrivilegedAction</span>&lt;Void&gt;() {
  <span class="kwd">public</span> Void <span class="fnc">run</span>() {
    method.<span class="fnc">setAccessible</span>(<span class="kwd">true</span>);
    <span class="kwd">return null</span>;
  }
});    

method.<span class="fnc">invoke</span>(names, <span class="str">&quot;Yoda&quot;</span>);</pre>        
        </p>
        <p>
          FEST-Reflect:
          <pre class="prettyprint">
<span class="fnc">method</span>(<span class="str">&quot;add&quot;</span>).<span class="fnc">withParameterTypes</span>(String.<span class="kwd">class</span>).<span class="fnc">in</span>(names).<span class="fnc">invoke</span>(<span class="str">&quot;Yoda&quot;</span>);</pre>
        </p>      
      </subsection>
      
      <subsection name="Invoking methods without parameters and return type other than 'void'">
        <p>
          Java Reflection:
          <pre class="prettyprint">
<span class="typ">Method</span> method = Names.<span class="kwd">class</span>.<span class="fnc">getMethod</span>(<span class="str">&quot;size&quot;</span>);

AccessController.<span class="fnc">doPrivileged</span>(<span class="kwd">new</span>&#160;<span class="fnc">PrivilegedAction</span>&lt;Void&gt;() {
  <span class="kwd">public</span> Void <span class="fnc">run</span>() {
    method.<span class="fnc">setAccessible</span>(<span class="kwd">true</span>);
    <span class="kwd">return null</span>;
  }
});    

<span class="kwd">int</span> size = (Integer) method.<span class="fnc">invoke</span>(names);</pre>
        </p>
        <p>
          FEST-Reflect:
          <pre class="prettyprint">
<span class="kwd">int</span> size = <span class="fnc">method</span>(<span class="str">&quot;size&quot;</span>).<span class="fnc">withReturnType</span>(<span class="kwd">int</span>.<span class="kwd">class</span>)
                         .<span class="fnc">in</span>(names)
                         .<span class="fnc">invoke</span>();</pre>
        </p>
      </subsection>

      <subsection name="Invoking methods with parameters and return type other than 'void'">
        <p>
          Java Reflection:
          <pre class="prettyprint">
<span class="typ">Method</span> method = Names.<span class="kwd">class</span>.<span class="fnc">getMethod</span>(<span class="str">&quot;get&quot;</span>, <span class="kwd">int</span>.<span class="kwd">class</span>);

AccessController.<span class="fnc">doPrivileged</span>(<span class="kwd">new</span>&#160;<span class="fnc">PrivilegedAction</span>&lt;Void&gt;() {
  <span class="kwd">public</span> Void <span class="fnc">run</span>() {
    method.<span class="fnc">setAccessible</span>(<span class="kwd">true</span>);
    <span class="kwd">return null</span>;
  }
});    

<span class="typ">String</span> name = (String) method.<span class="fnc">invoke</span>(names, 8);</pre>        
        </p>
        <p>
          FEST-Reflect:
          <pre class="prettyprint">
<span class="typ">String</span> name = <span class="fnc">method</span>(<span class="str">&quot;get&quot;</span>).<span class="fnc">withReturnType</span>(String.<span class="kwd">class</span>)
                           .<span class="fnc">withParameterTypes</span>(<span class="kwd">int</span>.<span class="kwd">class</span>)
                           .<span class="fnc">in</span>(names)
                           .<span class="fnc">invoke</span>(8);</pre>
        </p>      
      </subsection>      
    </section>
  </body>
</document>

